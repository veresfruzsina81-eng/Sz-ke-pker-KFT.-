<!doctype html>
<html lang="hu">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Termék – Szőke Épker</title>
<link rel="icon" href="/logo.png">
<style>
  :root{--brand:#0ea5e9;--ink:#1f2937}
  body{font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;margin:0;color:var(--ink);background:#fbfbfd}
  a{color:var(--brand);text-decoration:none}
  .container{max-width:1000px;margin:auto;padding:16px}
  header{border-bottom:1px solid #eee;background:#fff;position:sticky;top:0;z-index:10}
  .grid{display:grid;gap:18px;grid-template-columns:1fr 1fr}
  img{width:100%;border-radius:16px;object-fit:cover}
  .price{font-weight:800;font-size:22px}
  .btn{border:0;background:#e5e7eb;border-radius:10px;padding:10px 14px;cursor:pointer}
  .btn.primary{background:var(--brand);color:#fff}
  .card{background:#fff;border:1px solid #eee;border-radius:16px;padding:16px}
  .muted{color:#6b7280}
  textarea,input{width:100%;border:1px solid #e5e7eb;border-radius:10px;padding:10px 12px}
</style>
</head>
<body>
<header><div class="container"><a href="/webshop.html">← Vissza a webshopba</a></div></header>
<main class="container">
  <div id="content" class="grid"></div>

  <section class="card" style="margin-top:16px">
    <h3>Vélemények</h3>
    <div id="reviews"></div>
    <h4>Írj véleményt</h4>
    <form id="revForm" class="grid" style="grid-template-columns:1fr 1fr">
      <label><span>Név</span><input name="name" required></label>
      <label><span>Értékelés</span>
        <select name="rating"><option>5</option><option>4</option><option>3</option><option>2</option><option>1</option></select>
      </label>
      <label style="grid-column:1/-1"><span>Szöveg</span><textarea name="text" rows="3" required></textarea></label>
      <button class="btn primary" type="submit" style="grid-column:1/-1">Küldés</button>
    </form>
  </section>
</main>

<script type="module">
const urlp=new URLSearchParams(location.search); const PID=urlp.get("id");
const SUPABASE_URL="https://gckynywmoxylwyppmkck.supabase.co";
const SUPABASE_ANON="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdja3lueXdtb3h5bHd5cHBta2NrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzODUxODUsImV4cCI6MjA3NDk2MTE4NX0.0p2EsBFpWnYCq5IpQ6T3FsgKkJBNt0kGRd901sNBanI";
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
const sb=createClient(SUPABASE_URL,SUPABASE_ANON);

const fmt=n=>(n||0).toLocaleString("hu-HU")+" Ft";
const wrap=document.getElementById("content");
async function load(){
  const { data } = await sb.from("products").select("*").eq("id", PID).single();
  if(!data){ wrap.innerHTML="<p>Termék nem található.</p>"; return;}
  wrap.innerHTML=`<div><img src="${data.image_url||'/logo.png'}" alt=""></div>
    <div>
      <h1>${data.title||''}</h1>
      <div class="price">${fmt(data.price||0)}</div>
      <div class="muted" style="margin:10px 0;white-space:pre-wrap">${(data.description||"").trim()}</div>
      <button class="btn primary" id="add">Kosárba</button>
    </div>`;
}
load();

// vélemények
async function loadReviews(){
  const { data } = await sb.from("reviews").select("*").eq("product_id", PID).order("id",{ascending:false});
  const box=document.getElementById("reviews");
  box.innerHTML = (data||[]).map(r=>`
    <div class="card" style="margin-bottom:10px">
      <strong>${r.name}</strong> – ${'★'.repeat(r.rating||0)}<br>
      <div>${r.text}</div>
    </div>`).join("") || `<p class="muted">Még nincs vélemény.</p>`;
}
loadReviews();

document.getElementById("revForm").onsubmit=async (e)=>{
  e.preventDefault();
  const fd=Object.fromEntries(new FormData(e.target).entries());
  const payload={product_id:+PID,name:fd.name,rating:+fd.rating,text:fd.text};
  const { error } = await sb.from("reviews").insert(payload);
  if(error){ alert("Hiba: "+error.message); return; }
  e.target.reset(); loadReviews();
};
</script>
</body>
</html>
