
<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Term√©k ‚Äì Sz≈ëke √âpker</title>
  <style>
    :root{
      --bg:#f5f6f7;--card:#ffffff;--ink:#0f172a;--muted:#64748b;--brand:#0ea5e9;--brand-ink:#ffffff;
      --ring:rgba(14,165,233,.35);--ok:#16a34a;--warn:#f59e0b;--danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto}
    a{color:inherit;text-decoration:none}
    .container{max-width:1100px;margin:0 auto;padding:20px}
    header{position:sticky;top:0;z-index:5;background:rgba(245,246,247,.9);backdrop-filter:saturate(140%) blur(8px);border-bottom:1px solid #e5e7eb}
    header .wrap{display:flex;justify-content:space-between;align-items:center;gap:16px;padding:14px 0}
    .brand{display:flex;align-items:center;gap:10px}
    .brand img{height:40px}
    .brand h1{font-size:20px;margin:0}
    .btn,.btn-primary{display:inline-flex;align-items:center;gap:8px;border:1px solid #dbe1e8;border-radius:10px;padding:10px 14px;background:#fff;cursor:pointer}
    .btn:hover{border-color:#c9cfd7}
    .btn-primary{background:var(--brand);border-color:var(--brand);color:var(--brand-ink)}
    .btn-primary:hover{filter:brightness(.95)}
    /* layout */
    .sheet{display:grid;grid-template-columns:1fr 1fr;gap:24px}
    .media{background:#fff;border:1px solid #e5e7eb;border-radius:16px;overflow:hidden}
    .media img{width:100%;display:block;object-fit:cover}
    .info{background:#fff;border:1px solid #e5e7eb;border-radius:16px;padding:16px;display:grid;gap:10px}
    .title{font-weight:700;font-size:24px}
    .muted{color:var(--muted)}
    .price{font-weight:800;font-size:22px}
    .badge{font-size:12px;border-radius:999px;padding:4px 8px;border:1px solid #e5e7eb}
    .badge.ok{color:#065f46;border-color:#a7f3d0;background:#ecfdf5}
    .badge.out{color:#92400e;border-color:#fed7aa;background:#fffbeb}
    /* reviews */
    h3{margin:20px 0 8px}
    .rev{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:12px;margin-bottom:10px}
    .stars{color:#f59e0b}
    form .field{display:grid;gap:6px;margin-bottom:10px}
    input[type="text"],textarea,select{border:1px solid #dbe1e8;border-radius:10px;padding:10px 12px}
    textarea{min-height:70px;resize:vertical}
    @media (max-width:900px){.sheet{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <div class="container wrap">
      <div class="brand">
        <img src="logo.png" alt="Sz≈ëke √âpker Kft">
        <h1>Sz≈ëke √âpker Kft</h1>
      </div>
      <div style="display:flex;gap:10px;align-items:center">
        <a class="btn" href="index.html">‚Üê Vissza a weboldalra</a>
        <a class="btn-primary" href="webshop.html">üõç Vissza a webshophoz</a>
      </div>
    </div>
  </header>

  <main class="container">
    <div id="sheet" class="sheet" hidden>
      <div class="media"><img id="img" src="" alt=""></div>
      <div class="info">
        <div class="title" id="title">‚Äî</div>
        <div class="muted">Term√©kazonos√≠t√≥: <span id="pid"></span></div>
        <div class="row">
          <span id="stock" class="badge">‚Ä¶</span>
        </div>
        <div class="price" id="price">0 Ft</div>
        <div id="desc" class="muted">Nincs le√≠r√°s.</div>
        <div style="display:flex;gap:10px;margin-top:6px">
          <button id="add" class="btn-primary">Kos√°rba</button>
          <a class="btn" href="webshop.html">Tov√°bbi term√©kek</a>
        </div>
      </div>
    </div>

    <section style="margin-top:18px">
      <h3>V√©lem√©nyek</h3>
      <div id="reviews"></div>
      <form id="revForm">
        <div class="field"><label>N√©v</label><input id="r_name" type="text" required></div>
        <div class="field"><label>√ârt√©kel√©s</label>
          <select id="r_rate" required>
            <option value="5">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ (5)</option>
            <option value="4">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ (4)</option>
            <option value="3">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ (3)</option>
            <option value="2">‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ (2)</option>
            <option value="1">‚òÖ‚òÜ‚òÜ‚òÜ‚òÜ (1)</option>
          </select>
        </div>
        <div class="field"><label>V√©lem√©ny</label><textarea id="r_text" required></textarea></div>
        <button class="btn-primary" type="submit">V√©lem√©ny elk√ºld√©se</button>
      </form>
    </section>
  </main>

  <script type="module">
    // Supabase
    const SUPABASE_URL = "https://gckynywmoxylwyppmkck.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdja3lueXdtb3h5bHd5cHBta2NrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzODUxODUsImV4cCI6MjA3NDk2MTE4NX0.0p2EsBFpWnYCq5IpQ6T3FsgKkJBNt0kGRd901sNBanI";
    const sb = await import("https://esm.sh/@supabase/supabase-js@2");
    const supabase = sb.createClient(SUPABASE_URL, SUPABASE_KEY);

    // Elements
    const qs = s=>document.querySelector(s);
    const sheet = qs("#sheet"), img = qs("#img"), title = qs("#title"), pid=qs("#pid"),
          price = qs("#price"), desc = qs("#desc"), stockEl = qs("#stock"), addBtn = qs("#add");
    const reviewsEl = qs("#reviews");
    const revForm = qs("#revForm"), rName=qs("#r_name"), rRate=qs("#r_rate"), rText=qs("#r_text");

    const params = new URLSearchParams(location.search);
    const productId = params.get("id");

    function fmt(n){return new Intl.NumberFormat('hu-HU').format(n)+" Ft";}
    function stars(n){return "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ".slice(0,n)+"‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ".slice(n).replace(/‚òÜ+$/,"");}

    if(!productId){
      document.body.innerHTML = "<div class='container'><div class='rev'>Hi√°nyzik az azonos√≠t√≥.</div></div>";
    } else {
      load();
      loadReviews();
    }

    async function load(){
      const { data, error } = await supabase
        .from("products")
        .select("id,title,price,instock,image_url,description")
        .eq("id", productId)
        .single();
      if(error){ document.body.innerHTML = `<div class='container'><div class='rev'>Hiba: ${error.message}</div></div>`; return; }
      pid.textContent = data.id;
      title.textContent = data.title || "‚Äî";
      price.textContent = fmt(data.price||0);
      desc.textContent = data.description || "Nincs le√≠r√°s.";
      stockEl.textContent = data.instock ? "k√©szleten" : "nem el√©rhet≈ë";
      stockEl.className = "badge " + (data.instock ? "ok" : "out");
      img.src = data.image_url || "https://placehold.co/800x600?text=Nincs+k√©p";
      img.onerror = ()=>img.src="https://placehold.co/800x600?text=Nincs+k√©p";
      addBtn.disabled = !data.instock;
      addBtn.onclick = ()=>{
        const cart = JSON.parse(localStorage.getItem("cart")||"[]");
        const line = cart.find(x=>String(x.id)===String(data.id));
        if(line) line.qty++; else cart.push({id:data.id,title:data.title,price:data.price,image_url:data.image_url,qty:1});
        localStorage.setItem("cart", JSON.stringify(cart));
        alert("Hozz√°adva a kos√°rhoz.");
      };
      sheet.hidden = false;
    }

    async function loadReviews(){
      const { data, error } = await supabase
        .from("reviews")
        .select("id,username,text,rating,created_at")
        .eq("product_id", productId)
        .order("created_at", {ascending:false});
      if(error){ reviewsEl.innerHTML = `<div class='rev'>Hiba: ${error.message}</div>`; return; }
      reviewsEl.innerHTML = (data||[]).map(r=>`
        <div class="rev">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <strong>${r.username||'Anon'}</strong>
            <span class="stars">${"‚òÖ".repeat(r.rating)}${"‚òÜ".repeat(5-r.rating)}</span>
          </div>
          <div class="muted" style="font-size:12px">${new Date(r.created_at).toLocaleString('hu-HU')}</div>
          <div style="margin-top:6px">${r.text}</div>
        </div>
      `).join("") || `<div class="rev muted">M√©g nincs v√©lem√©ny.</div>`;
    }

    revForm.addEventListener("submit", async (e)=>{
      e.preventDefault();
      const payload = {
        product_id: productId,
        username: rName.value.trim(),
        text: rText.value.trim(),
        rating: parseInt(rRate.value,10)
      };
      const { error } = await supabase.from("reviews").insert(payload);
      if(error){ alert("Hiba: "+error.message); return; }
      rText.value=""; rName.value=""; rRate.value="5";
      await loadReviews();
      alert("K√∂sz√∂nj√ºk a v√©lem√©nyt! ‚úî");
    });
  </script>
</body>
</html>
