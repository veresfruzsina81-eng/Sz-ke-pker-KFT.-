<!doctype html>
<html lang="hu">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sz≈ëke-√âpker ‚Äì Webshop</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>
<style>
:root{--ink:#222;--muted:#7a8594;--bg:#f5f7fb;--card:#fff;--brand:#2f6fed;--brand-2:#245bcb;--ring:0 0 0 3px rgba(47,111,237,.18)}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui;background:var(--bg);color:var(--ink)}
.header{position:sticky;top:0;z-index:5;background:#fff;border-bottom:1px solid #e5e9f2}
.wrap{max-width:1200px;margin:0 auto;padding:14px 16px}
.row{display:flex;align-items:center;gap:10px}
.space{justify-content:space-between}
.brand img{height:26px}
.brand h1{font-size:18px;margin:0}
.btn{appearance:none;border:0;padding:9px 14px;border-radius:12px;cursor:pointer;font-weight:700;background:var(--brand);color:#fff}
.btn:hover{background:var(--brand-2)}
.btn.ghost{background:#fff;color:var(--brand);border:1px solid var(--brand)}
.badge{display:inline-flex;min-width:22px;height:22px;padding:0 6px;border-radius:999px;background:#111;color:#fff;font-size:12px;align-items:center;justify-content:center}

/* fels≈ë s√°v + keres≈ë + sz≈±r≈ë */
.shipping{position:relative;overflow:hidden;background:linear-gradient(90deg,#2f6fed,#54a7ff);color:#fff;border-radius:12px;padding:10px 14px;margin:14px auto 0;max-width:1200px;box-shadow:0 10px 22px rgba(22,29,37,.05)}
.shipping .row{gap:8px}
.shipping .truck{font-size:20px}
.shipping .marquee{position:absolute;inset:0;display:flex;align-items:center;gap:40px;padding-left:14px;opacity:.12;font-weight:700;letter-spacing:.4px;animation:marq 18s linear infinite;pointer-events:none}
@keyframes marq{from{transform:translateX(0)}to{transform:translateX(-50%)}}

.searchbar{margin:10px auto 0;max-width:1200px;display:flex;gap:8px;align-items:center}
.searchbar input{flex:1;border:1px solid #e5e9f2;background:#fff;padding:10px 12px;border-radius:12px;font-size:14px}
.searchbar input:focus{outline:none;box-shadow:var(--ring);border-color:#d6def7}
.filter{border:1px solid #e5e9f2;background:#fff;border-radius:12px;padding:9px 10px;font-size:14px}

/* === MINI REEL === */
.mini-reel{overflow:hidden;height:64px;border-radius:12px;background:#fff;box-shadow:0 6px 18px rgba(0,0,0,.06);margin:10px auto;max-width:1200px}
.mini-track{display:flex;align-items:center;gap:10px;padding:8px;animation:reelScroll 40s linear infinite;will-change:transform}
.mini-thumb{width:84px;height:48px;object-fit:cover;border-radius:8px;flex:0 0 auto}
@keyframes reelScroll{from{transform:translateX(0)}to{transform:translateX(-50%)}}

/* TERM√âKK√ÅRTY√ÅK */
.grid{display:grid;gap:12px;margin:16px auto;max-width:1200px}
@media(min-width:600px){.grid{grid-template-columns:repeat(2,1fr)}}
@media(min-width:1000px){.grid{grid-template-columns:repeat(3,1fr)}}
.card{background:var(--card);border:1px solid #e5e9f2;border-radius:14px;box-shadow:0 10px 22px rgba(22,29,37,.05);overflow:hidden;opacity:0;transform:translateY(20px);animation:fadeUp .6s forwards}
@keyframes fadeUp{to{opacity:1;transform:translateY(0)}}
.thumb{width:100%;height:220px;object-fit:contain;background:#fff;border-bottom:1px solid #eef2f8;display:block;padding:8px;cursor:zoom-in}
.px{padding:10px 12px}
.title{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.price{font-weight:700}
.muted{color:var(--muted)}
.qty{display:inline-flex;align-items:center;border:1px solid #e5e9f2;border-radius:999px;overflow:hidden}
.qty button{background:#fff;border:0;width:26px;height:26px;cursor:pointer}
.qty input{width:34px;border:0;text-align:center;appearance:textfield}
.qty input::-webkit-outer-spin-button,.qty input::-webkit-inner-spin-button{appearance:none;margin:0}

/* ikon gomb */
.icon-btn{background:#fff;border:1px solid #e5e9f2;border-radius:10px;width:36px;height:36px;display:inline-flex;align-items:center;justify-content:center;cursor:pointer;font-size:18px;line-height:1}
.icon-btn:hover{box-shadow:var(--ring)}

.toast{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);background:#111;color:#fff;padding:9px 12px;border-radius:10px;box-shadow:0 12px 24px rgba(0,0,0,.25);opacity:0;pointer-events:none;transition:.25s}
.toast.show{opacity:1}

/* LIGHTBOX */
.lb-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.75);display:grid;place-items:center;z-index:1000}
.lb-backdrop[hidden]{display:none}
.lb-img{max-width:90vw;max-height:90vh;border-radius:12px}
.lb-close{position:fixed;top:16px;right:16px;z-index:1001;width:40px;height:40px;font-size:28px;line-height:1;border:none;border-radius:50%;background:#fff;cursor:pointer}

/* OLDALS√ì KOS√ÅR FI√ìK */
.cart-drawer{position:fixed;top:0;right:0;height:100%;width:min(420px,92vw);background:#fff;box-shadow:-8px 0 24px rgba(0,0,0,.15);transform:translateX(100%);transition:transform .28s ease;z-index:1002;display:flex;flex-direction:column}
.cart-drawer.open{transform:translateX(0)}
.cart-scrim{position:fixed;inset:0;background:rgba(0,0,0,.35);z-index:1001}
.cart-scrim[hidden]{display:none}
.cart-head{padding:16px 16px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #eee}
.cart-list{list-style:none;margin:0;padding:8px 12px;overflow:auto;flex:1}
.cart-row{display:grid;grid-template-columns:48px 1fr auto 92px 32px;align-items:center;gap:8px;padding:10px 6px;border-bottom:1px dashed #eee}
.cart-row .thumb{width:42px;height:42px;object-fit:cover;border-radius:6px}
.cart-row .title{font-weight:500}
.cart-row .price{white-space:nowrap}
.cart-row .qty{width:88px;border-radius:10px}
.cart-empty{padding:16px;color:#777}
.btn-primary{width:100%;padding:12px 14px;border:none;border-radius:10px;background:#1a73e8;color:#fff;font-weight:600;cursor:pointer}
.btn-primary:disabled{opacity:.6;cursor:not-allowed}
.cart-foot{border-top:1px solid #eee;padding:12px}
.cart-foot .row{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}

/* === Szerencseker√©k modal (modern bels≈ë) === */
.wheel-scrim{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:1200}
.wheel-scrim[hidden]{display:none}
.wheel-modal{position:fixed;inset:0;display:grid;place-items:center;z-index:1201;padding:16px}
.wheel-modal[hidden]{display:none}
.wheel-modal>div{background:#0b1220;color:#e7ecf7;border-radius:18px;box-shadow:0 20px 50px rgba(0,0,0,.35);width:min(540px,92vw);padding:18px;position:relative;text-align:center;border:1px solid rgba(255,255,255,.08)}
.wheel-x{position:absolute;right:14px;top:14px;width:36px;height:36px;border:0;border-radius:10px;background:#10192f;color:#cbd5e1;font-size:18px;cursor:pointer}
.wheel-x:hover{background:#16223b}
.wheel-wrap{position:relative;display:grid;place-items:center;margin:10px auto}
.wheel-pointer{position:absolute;top:-6px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:12px solid transparent;border-right:12px solid transparent;border-bottom:18px solid #ffd166;filter:drop-shadow(0 3px 6px rgba(0,0,0,.5))}
#wheelCanvas{display:block;width:300px;height:300px;max-width:80vw;background:radial-gradient(120px 120px at 50% 50%, rgba(255,255,255,.06), transparent)}
.center-cap{position:absolute;width:84px;height:84px;border-radius:50%;background:#0b1220;border:2px solid rgba(255,255,255,.15);display:grid;place-items:center;box-shadow:0 10px 30px rgba(0,0,0,.35) inset}
.center-cap span{font:700 12px/1.1 "Inter",system-ui;color:#e7ecf7;letter-spacing:.3px;text-align:center}
.wheel-result{margin-top:12px;padding:10px;border-radius:10px;background:#10192f;border:1px solid rgba(255,255,255,.08);font-weight:600}

/* === Canvas konfetti (nyer√©skor 2 mp) === */
#confettiCanvas{position:fixed;inset:0;z-index:1300;pointer-events:none;display:none}
</style>
</head>
<body>
<header class="header">
  <div class="wrap row space">
    <div class="brand row"><img src="logo.png" alt=""><h1>Sz≈ëke-√âpker Kft.</h1></div>
    <div class="row">
      <a class="btn ghost" href="/">Vissza a weboldalra</a>
      <button id="cartOpen" class="btn">Kos√°r <span id="badge" class="badge">0</span></button>
    </div>
  </div>
</header>

<!-- Ingyenes sz√°ll√≠t√°s s√°v -->
<div class="shipping">
  <div class="row"><span class="truck">üöö</span> Ingyenes sz√°ll√≠t√°s 30 000 Ft felett</div>
  <div class="marquee">INGYENES SZ√ÅLL√çT√ÅS 30 000 FT FELETT ‚Ä¢ INGYENES SZ√ÅLL√çT√ÅS 30 000 FT FELETT ‚Ä¢</div>
</div>

<!-- Keres≈ë + Sz≈±r≈ë -->
<div class="searchbar wrap">
  <input id="q" type="search" placeholder="Keres√©s a term√©kek k√∂zt‚Ä¶">
  <select id="priceFilter" class="filter" aria-label="√År szerinti sz≈±r≈ë">
    <option value="all">√ñsszes √°r</option>
    <option value="lt5">&lt; 5 000 Ft</option>
    <option value="5to10">5 000 ‚Äì 10 000 Ft</option>
    <option value="gt10">&gt; 10 000 Ft</option>
  </select>
</div>

<!-- Mini k√©psor / Reel -->
<div class="mini-reel"><div class="mini-track" id="miniTrack"></div></div>

<main class="wrap">
  <section id="list" class="grid"></section>
  <p id="empty" class="muted" style="display:none;text-align:center">Nincs tal√°lat.</p>
</main>

<!-- Lightbox -->
<div id="imgLightbox" class="lb-backdrop" hidden>
  <button class="lb-close" aria-label="Bez√°r√°s">√ó</button>
  <img class="lb-img" alt="Preview">
</div>

<!-- Oldals√≥ kos√°r -->
<div id="cartDrawer" class="cart-drawer" aria-hidden="true">
  <div class="cart-head">
    <h3>Kos√°r</h3>
    <button id="cartClose" class="icon-btn" aria-label="Kos√°r bez√°r√°sa">√ó</button>
  </div>
  <ul id="cartItems" class="cart-list"></ul>
  <div class="cart-foot">
    <div class="row"><span>R√©sz√∂sszeg:</span><strong id="subTotal">0 Ft</strong></div>
    <div class="row"><span>Sz√°ll√≠t√°s:</span><strong id="shipCost">1 500 Ft</strong></div>
    <div class="row"><span>√ñsszesen:</span><strong id="cartTotal">0 Ft</strong></div>
    <button id="checkoutBtn" class="btn-primary">Tov√°bb a megrendel√©shez</button>
  </div>
</div>
<div id="cartScrim" class="cart-scrim" hidden></div>

<div id="toast" class="toast">Hozz√°adva a kos√°rhoz</div>

<!-- Szerencseker√©k (modern, canvas) -->
<div id="wheelScrim" class="wheel-scrim" hidden></div>
<div id="wheelModal" class="wheel-modal" hidden aria-modal="true" role="dialog" aria-labelledby="wheelTitle">
  <div>
    <button id="wheelClose" class="wheel-x" aria-label="Bez√°r√°s">√ó</button>
    <h3 id="wheelTitle" style="margin:4px 0 6px">P√∂rgesd meg a szerencsekereket!</h3>
    <p style="margin:0 0 6px;color:#9fb0c7">Ak√°r <strong>7%</strong> kedvezm√©ny ‚Äì egyszeri kupon.</p>
    <div class="wheel-wrap">
      <div class="wheel-pointer"></div>
      <canvas id="wheelCanvas" width="620" height="620" aria-label="Szerencseker√©k"></canvas>
      <div class="center-cap"><span>P√ñRGESD<br>MEG</span></div>
    </div>
    <button id="spinBtn" class="btn" style="width:100%;margin-top:8px">P√∂rget√©s</button>
    <div id="wheelResult" class="wheel-result" hidden></div>
  </div>
</div>

<!-- Konfetti -->
<canvas id="confettiCanvas"></canvas>

<script>
/* --- Supabase (v√°ltozatlan) --- */
const SB_URL="https://gckynywmoxylwyppmkck.supabase.co";
const SB_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdja3lueXdtb3h5bHd5cHBta2NrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzODUxODUsImV4cCI6MjA3NDk2MTE4NX0.0p2EsBFpWnYCq5IpQ6T3FsgKkJBNt0kGRd901sNBanI";
const sb=supabase.createClient(SB_URL,SB_KEY);

/* --- CART √©s UI (v√°ltozatlan) --- */
let PRODUCTS=[];
(function(){try{const nav=performance.getEntriesByType&&performance.getEntriesByType('navigation')[0];if(nav&&nav.type==='reload'){localStorage.removeItem('cart');}}catch(_){}})();
let CART=JSON.parse(localStorage.getItem("cart")||"[]");
const FREE_THRESHOLD=30000, SHIPPING_FEE=1500;
const HUF=n=>new Intl.NumberFormat('hu-HU').format(n||0)+" Ft";
const saveCart=()=>{localStorage.setItem("cart",JSON.stringify(CART));setBadge();};
const setBadge=()=>{document.getElementById('badge').textContent=CART.reduce((s,x)=>s+(x.qty||0),0);};
const toast=msg=>{const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),1200);};

function buildMiniReel(arr){const track=document.getElementById('miniTrack');if(!track)return;track.innerHTML='';const urls=(arr||[]).map(p=>p.image_url).filter(Boolean);if(urls.length<2)return;urls.concat(urls).forEach(u=>{const img=new Image();img.src=u;img.alt='';img.className='mini-thumb';track.appendChild(img);});}

function render(list){
  const box=document.getElementById('list');
  box.innerHTML=list.map((p,i)=>`
  <article class="card" style="animation-delay:${0.08*i}s">
    <img class="thumb" src="${p.image_url||'logo.png'}" alt="">
    <div class="px">
      <div class="row" style="justify-content:space-between">
        <div class="title" title="${p.title||''}">${p.title||'-'}</div>
        <div class="price">${HUF(p.price)}</div>
      </div>
      <div class="row" style="justify-content:space-between;margin-top:8px;flex-wrap:wrap">
        <div class="qty" style="flex:0 0 auto">
          <button data-act="minus" data-id="${p.id}" aria-label="Mennyis√©g cs√∂kkent√©se">‚àí</button>
          <input value="1" inputmode="numeric" pattern="[0-9]*" min="1" data-qty="${p.id}">
          <button data-act="plus" data-id="${p.id}" aria-label="Mennyis√©g n√∂vel√©se">+</button>
        </div>
        <div class="row" style="flex:1 1 auto;justify-content:flex-end;gap:8px">
          <button class="btn" data-add="${p.id}">Kos√°rba</button>
          <a class="btn ghost" href="product.html?id=${encodeURIComponent(p.id)}">Megnyit√°s</a>
        </div>
      </div>
    </div>
  </article>`).join('');
  document.getElementById('empty').style.display=list.length?'none':'block';
}

const drawer=document.getElementById('cartDrawer');
const scrim=document.getElementById('cartScrim');
const openBtn=document.getElementById('cartOpen');
const closeBtn=document.getElementById('cartClose');
function openCart(){drawer.classList.add('open');scrim.hidden=false;document.body.style.overflow='hidden';}
function closeCart(){drawer.classList.remove('open');scrim.hidden=true;document.body.style.overflow='';}
openBtn&&openBtn.addEventListener('click',openCart);
closeBtn&&closeBtn.addEventListener('click',closeCart);
scrim&&scrim.addEventListener('click',closeCart);

function renderCart(){
  const ul=document.getElementById('cartItems');
  const subEl=document.getElementById('subTotal');
  const shipEl=document.getElementById('shipCost');
  const totalEl=document.getElementById('cartTotal');
  ul.innerHTML=''; let subtotal=0;
  if(!CART.length){ul.innerHTML=`<li class="cart-empty">A kosarad √ºres.</li>`;}
  else{
    CART.forEach(p=>{
      const line=(p.price||0)*(p.qty||1); subtotal+=line;
      ul.insertAdjacentHTML('beforeend',`
        <li class="cart-row" data-id="${p.id}">
          <img class="thumb" src="${p.image_url||'logo.png'}" alt="${escapeHtml(p.title||'')}">
          <span class="title">${escapeHtml(p.title||'')}</span>
          <span class="price">${line.toLocaleString('hu-HU')} Ft</span>
          <input class="qty" type="number" min="1" value="${p.qty||1}">
          <button class="icon-btn remove" title="Elt√°vol√≠t√°s">√ó</button>
        </li>
      `);
    });
  }
  const shipping=(subtotal>=FREE_THRESHOLD||subtotal===0)?0:SHIPPING_FEE;
  const total=subtotal+shipping;
  subEl.textContent=subtotal.toLocaleString('hu-HU')+' Ft';
  shipEl.textContent=shipping.toLocaleString('hu-HU')+' Ft';
  totalEl.textContent=total.toLocaleString('hu-HU')+' Ft';
  setBadge(); localStorage.setItem("cart",JSON.stringify(CART));
}

document.getElementById('cartItems').addEventListener('click',(e)=>{
  if(e.target.closest('.remove')){const id=e.target.closest('.cart-row').dataset.id;CART=CART.filter(x=>String(x.id)!==String(id));renderCart();}
});
document.getElementById('cartItems').addEventListener('input',(e)=>{
  if(e.target.matches('.qty')){const row=e.target.closest('.cart-row');const id=row.dataset.id;const item=CART.find(x=>String(x.id)===String(id));if(item){const v=Math.max(1,parseInt(e.target.value||'1',10));item.qty=v;renderCart();}}
});

document.getElementById('list').addEventListener('click',e=>{
  const minus=e.target.closest('[data-act="minus"]');
  const plus=e.target.closest('[data-act="plus"]');
  const add=e.target.closest('[data-add]');
  if(minus){const id=minus.dataset.id;const q=document.querySelector(`[data-qty="${id}"]`);q.value=Math.max(1,parseInt(q.value||"1")-1);}
  if(plus){const id=plus.dataset.id;const q=document.querySelector(`[data-qty="${id}"]`);q.value=Math.max(1,parseInt(q.value||"1")+1);}
  if(add){
    const id=add.dataset.add;const p=PRODUCTS.find(x=>String(x.id)===String(id));
    const qEl=document.querySelector(`[data-qty="${id}"]`);const qty=Math.max(1,parseInt(qEl?.value||"1"));
    const i=CART.findIndex(x=>String(x.id)===String(id));
    if(i>=0)CART[i].qty+=qty;else CART.push({id:p.id,title:p.title,price:p.price,image_url:p.image_url,qty});
    saveCart(); toast("Hozz√°adva a kos√°rhoz"); renderCart(); openCart();
  }
});

document.getElementById('list').addEventListener('input',e=>{
  if(e.target.matches('[data-qty]')){const v=parseInt(e.target.value||"1",10);e.target.value=isNaN(v)||v<1?1:v;}
});

const qInput=document.getElementById('q');const priceFilter=document.getElementById('priceFilter');
function applyFilters(){
  const q=(qInput.value||'').toLowerCase().trim();const pf=priceFilter.value;
  let list=PRODUCTS.filter(p=>{
    const hit=(p.title||'').toLowerCase().includes(q)||(p.description||'').toLowerCase().includes(q);
    if(!hit)return false;const price=Number(p.price)||0;
    if(pf==='lt5')return price<5000;if(pf==='5to10')return price>=5000&&price<=10000;if(pf==='gt10')return price>10000;return true;
  }); render(list);
}
qInput.addEventListener('input',applyFilters); priceFilter.addEventListener('change',applyFilters);

const lb=document.getElementById('imgLightbox'); const lbImg=lb.querySelector('.lb-img');
document.addEventListener('click',(e)=>{if(e.target.matches('.thumb')){lbImg.src=e.target.src;lb.removeAttribute('hidden');document.body.style.overflow='hidden';}
  if(e.target.matches('#imgLightbox, #imgLightbox .lb-close')){lb.setAttribute('hidden','');lbImg.src='';document.body.style.overflow='';}
});
document.addEventListener('keydown',(e)=>{if(e.key==='Escape'){if(!lb.hasAttribute('hidden'))document.querySelector('.lb-close').click();if(drawer.classList.contains('open'))closeCart();}});

const CHECKOUT_URL="checkout.html";
document.getElementById('checkoutBtn').addEventListener('click',()=>{if(!CART.length)return;window.location.href=CHECKOUT_URL;});

async function load(){
  const {data,error}=await sb.from('products').select('id,title,price,description,image_url,instock,created_at').eq('instock',true).order('created_at',{ascending:false});
  if(error){document.getElementById('list').innerHTML="<p>Hiba: "+escapeHtml(error.message)+"</p>";return;}
  PRODUCTS=data||[]; render(PRODUCTS); setBadge(); renderCart(); buildMiniReel(PRODUCTS);
}
load();

function escapeHtml(s){return String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))}

/* === Szerencseker√©k ‚Äì modern canvas + val√≥s nyerem√©ny + 1 p√∂rget√©s === */
(function wheelInit(){
  const scrim=document.getElementById('wheelScrim');
  const modal=document.getElementById('wheelModal');
  const close=document.getElementById('wheelClose');
  const spinBtn=document.getElementById('spinBtn');
  const resultBox=document.getElementById('wheelResult');
  const canvas=document.getElementById('wheelCanvas');
  const ctx=canvas.getContext('2d');

  // Szeletek (felirat + sz√≠n + es√©ly s√∫ly)
  const SEGMENTS=[
    {label:"0%", color:"#0ea5e9", weight:18},
    {label:"3%", color:"#22c55e", weight:16},
    {label:"5%", color:"#f59e0b", weight:22},
    {label:"7%", color:"#ef4444", weight:12},
    {label:"0%", color:"#8b5cf6", weight:18},
    {label:"5%", color:"#06b6d4", weight:14}
  ];
  const N=SEGMENTS.length;
  const slice=(Math.PI*2)/N;
  let currentRot=0;
  let spinning=false;

  // Mutassuk fel egyszer munkamenetenk√©nt
  if(!sessionStorage.getItem('wheelShown')){openWheel(); sessionStorage.setItem('wheelShown','1');}
  else if(sessionStorage.getItem('wheelSpun')==='1'){disableSpin();} // ha m√°r p√∂rg√∂tt, legyen tiltva

  function openWheel(){scrim.hidden=false;modal.hidden=false;document.body.style.overflow='hidden';}
  function closeWheel(){scrim.hidden=true;modal.hidden=true;document.body.style.overflow='';}
  close.addEventListener('click',closeWheel); scrim.addEventListener('click',closeWheel);
  document.addEventListener('keydown',e=>{if(e.key==='Escape'&&!modal.hidden)closeWheel();});

  // Ker√©k rajzol√°sa (modern)
  const size=canvas.width, r=size/2, cx=r, cy=r;
  function draw(rotation=0){
    ctx.clearRect(0,0,size,size);
    ctx.save(); ctx.translate(cx,cy); ctx.rotate(rotation);
    for(let i=0;i<N;i++){
      const start=i*slice, end=start+slice;
      // szelet
      ctx.beginPath(); ctx.moveTo(0,0); ctx.arc(0,0,r-8,start,end); ctx.closePath();
      const grad=ctx.createLinearGradient(0,0, r*Math.cos((start+end)/2), r*Math.sin((start+end)/2));
      grad.addColorStop(0, lighten(SEGMENTS[i].color, .22));
      grad.addColorStop(1, SEGMENTS[i].color);
      ctx.fillStyle=grad; ctx.fill();
      // elv√°laszt√≥
      ctx.strokeStyle="rgba(255,255,255,.22)"; ctx.lineWidth=2; ctx.stroke();
      // felirat
      ctx.save(); ctx.rotate(start+slice/2);
      ctx.fillStyle="#0b1220"; ctx.font="700 24px Inter, system-ui"; ctx.textAlign="right"; ctx.textBaseline="middle";
      ctx.fillText(SEGMENTS[i].label, r-26, 0);
      ctx.restore();
    }
    // k√∂z√©p k√∂r
    ctx.beginPath(); ctx.arc(0,0,54,0,Math.PI*2); ctx.fillStyle="#0b1220"; ctx.fill();
    ctx.lineWidth=2; ctx.strokeStyle="rgba(255,255,255,.15)"; ctx.stroke();
    ctx.restore();
  }
  function lighten(hex, amt){ // egyszer≈± vil√°gos√≠t√°s
    const c=hex.replace('#',''); const n=parseInt(c,16);
    let r=(n>>16)&255, g=(n>>8)&255, b=n&255;
    r=Math.min(255,Math.round(r+(255-r)*amt));
    g=Math.min(255,Math.round(g+(255-g)*amt));
    b=Math.min(255,Math.round(b+(255-b)*amt));
    return `#${(r<<16|g<<8|b).toString(16).padStart(6,'0')}`;
  }
  draw(currentRot);

  // S√∫lyozott v√°laszt√°s ‚Äì val√≥s nyerem√©ny (nem fix 5%)
  function pickIndex(){
    const total=SEGMENTS.reduce((s,x)=>s+x.weight,0);
    let rnd=Math.random()*total;
    for(let i=0;i<N;i++){rnd-=SEGMENTS[i].weight; if(rnd<=0)return i;}
    return N-1;
  }

  spinBtn.addEventListener('click', async ()=>{
    if(spinning) return;
    if(sessionStorage.getItem('wheelSpun')==='1') return;
    spinning=true; spinBtn.setAttribute('disabled','true'); spinBtn.textContent='P√∂r√∂g‚Ä¶'; resultBox.hidden=true;

    const i=pickIndex();
    const extra= (Math.floor(Math.random()*2)+4) * Math.PI*2; // 4‚Äì5 teljes k√∂r
    // A mutat√≥ a v√°szon tetej√©n van (‚àí90¬∞), a szelet k√∂zepe legyen ott:
    const targetAngle = (Math.PI*3/2) - (i*slice + slice/2); // -90deg - center(i)
    const startRot=currentRot; const delta=normalize(targetAngle - startRot) + extra;

    await animate(t=>{
      const eased = 1 - Math.pow(1-t,3); // easeOutCubic
      currentRot = startRot + delta*eased; draw(currentRot);
    }, 3500);

    currentRot = startRot + delta; draw(currentRot);

    const prizeText = SEGMENTS[i].label; // pl. "7%"
    const prizeNum = parseInt(prizeText,10)||0;

    resultBox.hidden=false;
    if(prizeNum>0){
      const code=`SAVE${prizeNum}-${Math.random().toString(36).slice(2,6).toUpperCase()}`;
      resultBox.innerHTML=`üéâ <strong>Gratul√°lunk!</strong><br>Nyert√©l <b>${prizeNum}%</b> kupont!<br>K√≥d: <code>${code}</code>`;
      sessionStorage.setItem('couponPercent', String(prizeNum));
      sessionStorage.setItem('couponCode', code);
      runConfetti(2000);
    }else{
      resultBox.innerHTML=`üò• <strong>Sajn√°ljuk!</strong><br>Most nem nyert√©l kupont.`;
    }

    // 1 p√∂rget√©s szab√°ly ‚Äî tart√≥s tilt√°s a munkamenetben
    sessionStorage.setItem('wheelSpun','1');
    disableSpin();
    spinning=false;
  });

  function disableSpin(){
    spinBtn.setAttribute('disabled','true');
    spinBtn.textContent='M√°r p√∂rgett√©l';
    spinBtn.style.opacity='0.7';
    spinBtn.style.cursor='not-allowed';
  }

  function normalize(a){return a;} // itt nem kell tov√°bbi m√≥dos√≠t√°s

  function animate(step, duration){
    return new Promise(resolve=>{
      const t0=performance.now();
      function frame(now){
        const t=Math.min(1,(now-t0)/duration); step(t);
        if(t<1) requestAnimationFrame(frame); else resolve();
      }
      requestAnimationFrame(frame);
    });
  }
})();

/* === Profi Canvas-konfetti (2 mp) === */
(function confettiSetup(){
  const canvas=document.getElementById('confettiCanvas');
  const ctx=canvas.getContext('2d'); let parts=[], running=false;
  function resize(){canvas.width=innerWidth; canvas.height=innerHeight;}
  addEventListener('resize',resize); resize();
  function makeParts(){
    const N=Math.min(250, Math.floor((canvas.width*canvas.height)/12000));
    parts=new Array(N).fill(0).map(()=>({
      x:Math.random()*canvas.width, y:-10-Math.random()*canvas.height*0.2,
      vx:(Math.random()-.5)*3, vy:3+Math.random()*3,
      w:6+Math.random()*6, h:10+Math.random()*14,
      rot:Math.random()*Math.PI, vr:(Math.random()-.5)*0.3,
      color:randColor()
    }));
  }
  function randColor(){const p=["#22c55e","#3b82f6","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#eab308","#10b981"]; return p[(Math.random()*p.length)|0];}
  function loop(endAt){
    if(!running) return; const now=performance.now();
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(const p of parts){
      p.x+=p.vx; p.y+=p.vy; p.rot+=p.vr; p.vy+=0.03;
      ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot);
      ctx.fillStyle=p.color; ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h); ctx.restore();
      if(p.y>canvas.height+40){p.y=-20;p.x=Math.random()*canvas.width;p.vy=3+Math.random()*3;}
    }
    if(now<endAt) requestAnimationFrame(()=>loop(endAt)); else {running=false; canvas.style.display='none';}
  }
  window.runConfetti=function(ms=2000){
    makeParts(); canvas.style.display='block'; running=true;
    const endAt=performance.now()+ms; loop(endAt);
  };
})();
</script>

<footer style="background:#f5f7fb;border-top:1px solid #e5e9f2;padding:20px;margin-top:40px;font-size:14px;color:#555">
  <div class="wrap row space" style="flex-wrap:wrap;gap:10px">
    <div>¬© 2025 Sz≈ëke-√âpker Kft. Minden jog fenntartva.</div>
    <div class="row" style="gap:14px">
      <a href="adatvedelem.html">Adatv√©delmi t√°j√©koztat√≥</a>
      <a href="aszf.html">√ÅSZF</a>
      <a href="kapcsolat.html">Kapcsolat</a>
    </div>
  </div>
</footer>
</body>
</html>
