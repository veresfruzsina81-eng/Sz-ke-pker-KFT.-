<!doctype html>
<html lang="hu">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin – Szőke Épker</title>
<style>
  :root{--brand:#0a4a7a;--bg:#f5f6f8;--card:#fff;--muted:#667085}
  *{box-sizing:border-box} body{margin:0;font:16px/1.5 system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:#111}
  header{background:var(--brand);color:#fff;padding:14px 18px}
  header h1{margin:0;font-size:20px}
  main{max-width:1100px;margin:18px auto;padding:0 16px}
  .card{background:#fff;border:1px solid #e6e8ec;border-radius:14px;padding:14px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  label{display:flex;flex-direction:column;gap:6px;font-size:14px}
  input,textarea{border:1px solid #d0d5dd;border-radius:10px;padding:10px;background:#fff}
  textarea{min-height:80px;resize:vertical}
  .btn{border:none;background:#0ea5e9;color:#fff;border-radius:10px;padding:10px 14px;cursor:pointer}
  .btn.ghost{background:#eef2f7;color:#111}
  .list{margin-top:16px;display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px}
  .item{background:var(--card);border:1px solid #e6e8ec;border-radius:12px;overflow:hidden}
  .item img{width:100%;height:170px;object-fit:cover;background:#eee}
  .row{display:flex;justify-content:space-between;align-items:center;padding:10px}
  .muted{color:var(--muted);font-size:13px;margin:8px 10px}
  .login{max-width:520px;margin:60px auto}
</style>
</head>
<body>
<header><h1>Admin felület</h1></header>
<main>
  <section id="login" class="login card">
    <h2>Belépés</h2>
    <p class="muted">Felhasználónév: <code>szokeadmin</code>, Jelszó: <code>szoke2025</code></p>
    <div class="grid">
      <label>Felhasználónév<input id="user"></label>
      <label>Jelszó<input id="pass" type="password"></label>
    </div>
    <div style="margin-top:12px;display:flex;gap:10px">
      <button class="btn" id="go">Belépés</button>
    </div>
  </section>

  <section id="app" hidden>
    <div class="card">
      <h2>Új termék</h2>
      <div class="grid">
        <label>Név*<input id="pTitle" required></label>
        <label>Ár (Ft)*<input id="pPrice" type="number" min="0" required></label>
        <label class="grid" style="grid-column:1/-1">Leírás<textarea id="pDesc"></textarea></label>
        <label style="grid-column:1/-1">Kép URL (jpg/png)*<input id="pImg" placeholder="https://…"></label>
        <label><input id="pStock" type="checkbox" checked> Készleten</label>
      </div>
      <div style="margin-top:10px;display:flex;gap:8px">
        <button class="btn" id="addBtn">Hozzáadás</button>
        <button class="btn ghost" id="refresh">Lista frissítése</button>
        <button class="btn ghost" id="logout">Kijelentkezés</button>
      </div>
    </div>

    <div class="card">
      <h2>Termékek</h2>
      <div id="list" class="list">Betöltés…</div>
    </div>
  </section>
</main>

<script type="module">
/*** SUPABASE ***/
const SUPA_URL = "https://gckynywmoxylwyppmkck.supabase.co";
const SUPA_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdja3lueXdtb3h5bHd5cHBta2NrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzODUxODUsImV4cCI6MjA3NDk2MTE4NX0.0p2EsBFpWnYCq5IpQ6T3FsgKkJBNt0kGRd901sNBanI";
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
const supa = createClient(SUPA_URL, SUPA_KEY);

/*** SIMPLE HELYI LOGIN ***/
const login = document.getElementById('login');
const app = document.getElementById('app');
document.getElementById('go').onclick = ()=>{
  const u = (document.getElementById('user').value||"").trim();
  const p = (document.getElementById('pass').value||"").trim();
  if(u==='szokeadmin' && p==='szoke2025'){
    login.hidden = true; app.hidden = false; load();
  }else{
    alert('Hibás jelszó vagy inaktív fiók.');
  }
};
document.getElementById('logout').onclick = ()=>{ app.hidden=true; login.hidden=false; };

/*** CRUD ***/
const list = document.getElementById('list');
async function load(){
  list.textContent = 'Betöltés…';
  const { data, error } = await supa.from('products').select('id,title,price,description,image_url,instock,created_at').order('created_at',{ascending:false});
  if(error){ list.textContent = 'Hiba a listázáskor.'; console.error(error); return; }
  if(!data.length){ list.textContent = 'Még nincs termék.'; return; }
  list.innerHTML = data.map(p=>`
    <article class="item">
      <img src="${p.image_url || 'https://placehold.co/800x600?text=K%C3%A9p'}" alt="">
      <div class="row"><strong>${p.title}</strong><span>${new Intl.NumberFormat('hu-HU').format(p.price)} Ft</span></div>
      <div class="muted">${p.instock===false?'Nem elérhető':'Készleten'}</div>
      <div class="row">
        <button class="btn ghost" data-edit="${p.id}" disabled>Szerk.</button>
        <button class="btn" data-del="${p.id}">Törlés</button>
      </div>
    </article>
  `).join('');
}
document.getElementById('refresh').onclick = load;

document.addEventListener('click', async e=>{
  const t = e.target;
  if(t.matches('[data-del]')){
    if(!confirm('Biztos törlöd?')) return;
    const id = t.getAttribute('data-del');
    const { error } = await supa.from('products').delete().eq('id', id);
    if(error){ alert('Törlés hiba: '+error.message); return; }
    load();
  }
});

document.getElementById('addBtn').onclick = async ()=>{
  const title = document.getElementById('pTitle').value.trim();
  const price = parseInt(document.getElementById('pPrice').value||'0',10);
  const description = document.getElementById('pDesc').value.trim();
  const image_url = document.getElementById('pImg').value.trim();
  const instock = document.getElementById('pStock').checked;
  if(!title || !price || !image_url) return alert('Név, ár és kép URL kötelező.');

  const { error } = await supa.from('products').insert([{ title, price, description, image_url, instock }]);
  if(error){ alert('Mentési hiba: '+error.message); return; }
  document.getElementById('pTitle').value='';
  document.getElementById('pPrice').value='';
  document.getElementById('pDesc').value='';
  document.getElementById('pImg').value='';
  document.getElementById('pStock').checked=true;
  load();
};

/*** INDULÁS ***/
</script>

</body>
</html>
