<!doctype html>
<html lang="hu">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Termék</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>body{margin:0;background:#fafafb;font-family:Inter} .wrap{max-width:1000px;margin:0 auto;padding:20px}
.btn{border:1px solid #e5e7eb;background:#fff;border-radius:12px;padding:10px 14px;font-weight:600;cursor:pointer}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:16px} @media(max-width:900px){.grid{grid-template-columns:1fr}}
.card{background:#fff;border:1px solid #e5e7eb;border-radius:16px;padding:16px}
img{width:100%;border-radius:12px;border:1px solid #e5e7eb;object-fit:cover}
.price{font-weight:700} .muted{color:#6b7280}
.rate .star{cursor:pointer} .badge{display:inline-block;background:#eef2f7;border:1px solid #e5e7eb;border-radius:999px;padding:6px 10px;font-size:12px;color:#334155}
</style>
</head>
<body>
<div class="wrap">
  <div style="display:flex;gap:10px;align-items:center;margin-bottom:10px">
    <button class="btn" onclick="history.back()">⬅ Vissza</button>
    <a class="btn" href="webshop.html">Webshop</a>
  </div>
  <div class="grid">
    <div class="card"><img id="img" alt=""></div>
    <div class="card">
      <h2 id="title"></h2>
      <div id="avail" class="muted"></div>
      <div id="price" class="price" style="margin:8px 0"></div>
      <div id="desc" style="white-space:pre-wrap"></div>
      <div style="margin-top:12px"><button class="btn" id="add">Kosárba</button></div>
    </div>
  </div>

  <div class="card" style="margin-top:16px">
    <h3>Vélemények</h3>
    <div id="revList" class="muted">Még nincs vélemény.</div>
    <div class="badge" style="margin:8px 0">Írj véleményt</div>
    <input id="rvName" class="btn" style="width:100%;text-align:left" placeholder="Név">
    <div class="rate" id="rvStars">★ ★ ★ ★ ☆</div>
    <textarea id="rvText" class="btn" style="width:100%;min-height:90px;text-align:left" placeholder="Vélemény…"></textarea>
    <div><button class="btn" id="sendRev">Küldés</button></div>
  </div>
</div>

<script type="module">
const u=new URLSearchParams(location.search); const pid=u.get("id");
const SUPABASE_URL="https://gckynywmoxylwyppmkck.supabase.co";
const SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdja3lueXdtb3h5bHd5cHBta2NrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzODUxODUsImV4cCI6MjA3NDk2MTE4NX0.0p2EsBFpWnYCq5IpQ6T3FsgKkJBNt0kGRd901sNBanI";
if(!window.supabase){await new Promise(r=>{const s=document.createElement("script");s.src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.js";s.onload=r;document.head.appendChild(s);});}
const sb=supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY);
const fmt=n=> (n||0).toLocaleString('hu-HU')+" Ft";

async function load(){
  const { data, error } = await sb.from("products").select("*").eq("id", pid).single();
  if(error||!data){ document.body.innerHTML="<div class='wrap'>Nem található termék.</div>"; return; }
  img.src=data.image_url||'logo.png'; title.textContent=data.title||""; avail.textContent=data.instock?'Készleten':'Nem elérhető';
  price.textContent=fmt(data.price||0); desc.textContent=data.description||"";
  add.onclick=()=>alert("Kosár funkció itt is beköthető (a webshop.html kosarához ugyanazzal a kulccsal).");
  loadRevs();
}
async function loadRevs(){
  const box=revList; const { data, error } = await sb.from("reviews").select("username,stars,text,created_at").eq("product_id", pid).order("created_at",{ascending:false});
  if(error||!data?.length){ box.textContent="Még nincs vélemény."; return; }
  box.innerHTML=data.map(r=>`<div style="border:1px solid #e5e7eb;border-radius:12px;padding:10px;margin:8px 0;background:#fff">
  <div style="display:flex;justify-content:space-between"><strong>${r.username||"Vendég"}</strong><span>${"★".repeat(+r.stars||0)}${"☆".repeat(5-(+r.stars||0))}</span></div>
  <div style="color:#6b7280;font-size:12px">${new Date(r.created_at).toLocaleString('hu-HU')}</div>
  <div style="margin-top:6px;white-space:pre-wrap">${r.text||""}</div></div>`).join("");
}
let s=4; document.getElementById("rvStars").addEventListener("click",e=>{ s = s===5?1:s+1; e.currentTarget.textContent = "★ ".repeat(s)+"☆ ".repeat(5-s); });
document.getElementById("sendRev").addEventListener("click", async ()=>{
  const username=document.getElementById("rvName").value.trim()||"Vendég";
  const text=document.getElementById("rvText").value.trim();
  const { error } = await sb.from("reviews").insert({ product_id: pid, username, text, stars:s });
  alert(error?("Nem sikerült: "+error.message):"Köszönjük!"); loadRevs();
});
load();
</script>
</body>
</html>
