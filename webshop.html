<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Webshop – Szőke Épker KFT.</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .shop-wrap{max-width:1100px;margin:24px auto;padding:0 16px}
    .shop-toolbar{display:flex;gap:10px;margin:10px 0}
    .shop-toolbar input, .shop-toolbar select{flex:1;min-height:40px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}
    .card{border:1px solid #e5e7eb;border-radius:12px;overflow:hidden;background:#fff}
    .pic{aspect-ratio:16/10;background:#f6f7f9;display:grid;place-items:center}
    .pic img{width:100%;height:100%;object-fit:cover;cursor:zoom-in}
    .meta{padding:10px 12px}
    .price{font-weight:700}
    .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:1px solid #111827;background:#111827;color:#fff;cursor:pointer}
    .muted{color:#6b7280}
    /* Lightbox */
    .lb{position:fixed;inset:0;background:rgba(0,0,0,.8);display:none;align-items:center;justify-content:center;z-index:50}
    .lb img{max-width:92vw;max-height:92vh;border-radius:12px}
  </style>
  <script src="https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>
</head>
<body>

<header class="site-header">
  <div class="container header-inner">
    <a href="index.html#fooldal" class="brand">
      <img src="logo.png" alt="Szőke Épker KFT. logó" />
      <span class="brand-text">Szőke Épker KFT.</span>
    </a>
    <nav class="main-nav">
      <a href="index.html#fooldal">Főoldal</a>
      <a href="index.html#szolgaltatasok">Szolgáltatások</a>
      <a href="index.html#rolunk">Rólunk</a>
      <a href="index.html#bemutatkozas">Bemutatkozás</a>
      <a href="index.html#referenciak">Referenciák</a>
      <a href="index.html#ajanlatkeres">Ajánlatkérés</a>
      <a href="index.html#kapcsolat" class="pill">Kapcsolat</a>
      <a href="webshop.html" class="pill">Webshop</a>
    </nav>
  </div>
</header>

<main>
  <section class="section soft-bg">
    <div class="shop-wrap">
      <h2 class="section-title">Webshop</h2>
      <p class="lead">Hamarosan.</p>

      <div class="shop-toolbar">
        <input id="q" type="search" placeholder="Keresés a termékek között…">
        <select id="sort">
          <option value="created">Rendezés: Legújabb</option>
          <option value="price-asc">Ár szerint (növ.)</option>
          <option value="price-desc">Ár szerint (csökk.)</option>
          <option value="name-asc">Név szerint (A–Z)</option>
          <option value="name-desc">Név szerint (Z–A)</option>
        </select>
      </div>

      <div id="list" class="grid">
        <div class="muted">Betöltés…</div>
      </div>
    </div>
  </section>
</main>

<div class="lb" id="lb"><img alt=""><!-- lightbox --></div>

<script>
/* ==== SUPABASE INIT – a TE adataiddal ==== */
const SUPABASE_URL = "https://gckynywmoxylwyppmkck.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdja3lueXdtb3h5bHd5cHBta2NrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzODUxODUsImV4cCI6MjA3NDk2MTE4NX0.0p2EsBFpWnYCq5IpQ6T3FsgKkJBNt0kGRd901sNBanI";
const _sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const $ = s => document.querySelector(s);
const qEl = $("#q"), sortEl = $("#sort"), list = $("#list");

function fmt(n){ return new Intl.NumberFormat("hu-HU").format(n)+" Ft"; }

async function load(){
  list.innerHTML = '<div class="muted">Betöltés…</div>';
  let { data, error } = await _sb.from("products").select("*").eq("in_stock", true);
  if(error){ list.innerHTML = '<div class="muted">Hiba: '+error.message+'</div>'; return; }

  // keresés
  const q = (qEl.value||"").toLowerCase().trim();
  if(q) data = data.filter(p => (p.title||"").toLowerCase().includes(q) || (p.description||"").toLowerCase().includes(q));

  // rendezés
  switch(sortEl.value){
    case "price-asc":  data.sort((a,b)=>a.price-b.price); break;
    case "price-desc": data.sort((a,b)=>b.price-a.price); break;
    case "name-asc":   data.sort((a,b)=>(a.title||"").localeCompare(b.title||"","hu")); break;
    case "name-desc":  data.sort((a,b)=>(b.title||"").localeCompare(a.title||"","hu")); break;
    default:           data.sort((a,b)=>new Date(b.created_at)-new Date(a.created_at));
  }

  if(!data.length){ list.innerHTML = '<div class="muted">Jelenleg nincs elérhető termék.</div>'; return; }

  list.innerHTML = data.map(p=>`
    <div class="card">
      <div class="pic">${p.image_url ? `<img src="${p.image_url}" alt="${p.title}" data-zoom>` : `<span class="muted">nincs kép</span>`}</div>
      <div class="meta">
        <strong>${p.title||""}</strong>
        ${p.description ? `<div class="muted">${p.description.replace(/</g,"&lt;")}</div>` : ""}
        <div style="display:flex;align-items:center;gap:10px;margin-top:6px">
          <span class="price">${fmt(p.price||0)}</span>
          <button class="btn" disabled>Kosárba</button>
        </div>
      </div>
    </div>
  `).join("");

  // lightbox
  list.querySelectorAll("[data-zoom]").forEach(img=>{
    img.addEventListener("click", ()=>{
      const lb=$("#lb"); lb.style.display="flex"; lb.querySelector("img").src = img.src;
    });
  });
}

$("#lb").addEventListener("click", e=>{ if(e.target.id==="lb") e.currentTarget.style.display="none"; });
qEl.addEventListener("input", load);
sortEl.addEventListener("change", load);

load();
</script>
</body>
</html>
